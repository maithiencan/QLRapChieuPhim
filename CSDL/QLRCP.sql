CREATE DATABASE QLRapChieuPhim

GO

USE [QLRapChieuPhim]
GO


CREATE TABLE [NHANVIEN]
(
  MANV [NVARCHAR](10) CONSTRAINT NV_MANV_PK PRIMARY KEY, -- primary key column
  HOVATENNV [NVARCHAR](50) NOT NULL,
  DIACHI [NVARCHAR](100) NOT NULL,
  SDT [NVARCHAR](10),
  NGAYSINH [DATETIME] NOT NULL,
  PHAI [TINYINT] NOT NULL,
  LUONG [INT],
  CA [NVARCHAR](10),
  MACV [NVARCHAR] (3) NOT NULL
);
GO

CREATE TABLE [CHUCVU]
(
  MACV [NVARCHAR](3) PRIMARY KEY NOT NULL,
  TENCHUCVU [NVARCHAR](50) NOT NULL
);
GO

CREATE TABLE [KHACHHANG]
(
  MAKH NVARCHAR(10) CONSTRAINT KH_MAKH_PK PRIMARY KEY,
  HOVATENKH [NVARCHAR](50) NOT NULL,
  SDT [NVARCHAR](10),
  DIACHI [NVARCHAR](100) NOT NULL,
  NGAYSINH [DATETIME] NOT NULL
);
GO



CREATE TABLE [LOAIVE]
(
  MALV NVARCHAR(10) CONSTRAINT LV_MALV_PK PRIMARY KEY,
  TENLV [NVARCHAR](20) NOT NULL,
  DONGIA [INT]
);
GO


CREATE TABLE [VE]
(
  MAVE NVARCHAR(10)NOT NULL,
  MALV [NVARCHAR](10) NOT NULL,
  MANV [NVARCHAR](10) NOT NULL,
  MAKH [NVARCHAR](10) NOT NULL,
  GHE [INT] NOT NULL,
  MASUAT [NVARCHAR](10) NOT NULL,
  NGAYBANVE [DATETIME] NOT NULL,
  TRANGTHAI TINYINT
  PRIMARY KEY(MAVE, MASUAT)
);
GO


CREATE TABLE [DINHDANGPHIM]
(
  MADP NVARCHAR(10) CONSTRAINT DDP_MADP_PK PRIMARY KEY, -- primary key column
  DANGPHIM [NVARCHAR](20) NOT NULL
  -- specify more columns here
);
GO



CREATE TABLE [THELOAIPHIM]
(
  MALP NVARCHAR(10) CONSTRAINT LP_MALP_PK PRIMARY KEY, -- primary key column
  LOAIPHIM [NVARCHAR](50) NOT NULL
  -- specify more columns here
);
GO



CREATE TABLE [PHIM]
(
  MAPHIM NVARCHAR(10) CONSTRAINT P_MAPHIM_PK PRIMARY KEY, -- primary key column
  MALP [NVARCHAR](10) NOT NULL,
  MADP [NVARCHAR](10) NOT NULL,
  TENPHIM [NVARCHAR](100) NOT NULL,
  NHASX [NVARCHAR](100) NOT NULL
  
);
GO



CREATE TABLE [PHONGCHIEU]
(
  MAPHONG NVARCHAR(10) CONSTRAINT PC_MAPHONG_PK PRIMARY KEY, -- primary key column
  TENPHONG [NVARCHAR](20) NOT NULL
);
GO


CREATE TABLE [SUATCHIEU]
(
  MASUAT [NVARCHAR](10) PRIMARY KEY,
  MAPHIM [NVARCHAR](10) NOT NULL,
  MAPHONG [NVARCHAR](10) NOT NULL,
  KHOICHIEU [DATETIME] NOT NULL,  
);

GO
CREATE TABLE [TAIKHOAN] (
    ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    MANV NVARCHAR(10) NOT NULL UNIQUE,
    TENTAIKHOAN NVARCHAR(50) NOT NULL UNIQUE,
    MATKHAU NVARCHAR(100) NOT NULL,
    QUYENHAN NVARCHAR(30) NOT NULL
);
GO



ALTER TABLE SUATCHIEU
ADD CONSTRAINT FK_SUATCHIEU_PHONGCHIEU 
FOREIGN KEY (MAPHONG) REFERENCES PHONGCHIEU (MAPHONG)
ON DELETE CASCADE;

ALTER TABLE VE
ADD CONSTRAINT FK_VE_LOAIVE 
FOREIGN KEY (MALV) REFERENCES LOAIVE (MALV)ON DELETE CASCADE;

ALTER TABLE VE
ADD CONSTRAINT FK_VE_KHACHHANG 
FOREIGN KEY (MAKH) REFERENCES KHACHHANG (MAKH)ON DELETE CASCADE;

ALTER TABLE VE
ADD CONSTRAINT FK_VE_NHANVIEN 
FOREIGN KEY (MANV) REFERENCES NHANVIEN (MANV)ON DELETE CASCADE;

ALTER TABLE PHIM
ADD CONSTRAINT FK_PHIM_THELOAIPHIM 
FOREIGN KEY (MALP) REFERENCES THELOAIPHIM (MALP)ON DELETE CASCADE;

ALTER TABLE PHIM
ADD CONSTRAINT FK_PHIM_DINHDANGPHIM 
FOREIGN KEY (MADP) REFERENCES DINHDANGPHIM (MADP)ON DELETE CASCADE;

ALTER TABLE SUATCHIEU
ADD CONSTRAINT FK_SUATCHIEU_PHIM 
FOREIGN KEY (MAPHIM) REFERENCES PHIM (MAPHIM)ON DELETE CASCADE;

ALTER TABLE NHANVIEN
ADD CONSTRAINT FK_NHANVIEN_CV
FOREIGN KEY (MACV) REFERENCES CHUCVU(MACV) ON DELETE CASCADE;

ALTER TABLE NHANVIEN
ADD CONSTRAINT CK_NHANVIEN_TUOI CHECK (DATEDIFF(YEAR, NGAYSINH, GETDATE()) >= 18);


ALTER TABLE TAIKHOAN
ADD CONSTRAINT FK_TAIKHOAN_NHANVIEN 
FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV) ON DELETE CASCADE;

ALTER TABLE VE
ADD CONSTRAINT FK_VE_SUATCHIEU
FOREIGN KEY (MASUAT) REFERENCES SUATCHIEU (MASUAT)ON DELETE CASCADE;

SELECT MASUAT, GHE, COUNT(*)
FROM VE
GROUP BY MASUAT, GHE
HAVING COUNT(*) > 1;

WITH CTE AS (
    SELECT MASUAT, GHE,
           ROW_NUMBER() OVER (PARTITION BY MASUAT, GHE ORDER BY (SELECT NULL)) AS RowNum
    FROM VE
)
DELETE FROM CTE
WHERE RowNum > 1;

ALTER TABLE VE
ADD CONSTRAINT UQ_Ghe UNIQUE (MASUAT, GHE);





GO

INSERT INTO [CHUCVU] (MACV, TENCHUCVU) VALUES ('QL',N'Quản lí');
INSERT INTO [CHUCVU] (MACV, TENCHUCVU) VALUES ('PQL',N'Phó quản lí');
INSERT INTO [CHUCVU] (MACV, TENCHUCVU) VALUES ('KTV',N'Kỹ thuật viên');
INSERT INTO [CHUCVU] (MACV, TENCHUCVU) VALUES ('KD',N'Kinh doanh');
INSERT INTO [CHUCVU] (MACV, TENCHUCVU) VALUES ('MKT',N'Marketing');
INSERT INTO [CHUCVU] (MACV, TENCHUCVU) VALUES ('BVE',N'Nhân viên bán vé');
INSERT INTO [CHUCVU] (MACV, TENCHUCVU) VALUES ('SVE',N'Nhân viên soát vé');
INSERT INTO [CHUCVU] (MACV, TENCHUCVU) VALUES ('TP',N'Nhân viên quầy thực phẩm');
INSERT INTO [CHUCVU] (MACV, TENCHUCVU) VALUES ('HTR',N'Nhân viên hỗ trợ khách hàng');
INSERT INTO [CHUCVU] (MACV, TENCHUCVU) VALUES ('NS',N'Nhân viên nhân sự');
INSERT INTO [CHUCVU] (MACV, TENCHUCVU) VALUES ('KT',N'Kế toán');
INSERT INTO [CHUCVU] (MACV, TENCHUCVU) VALUES ('BV',N'Bảo vệ');
INSERT INTO [CHUCVU] (MACV, TENCHUCVU) VALUES ('VS',N'Nhân viên vệ sinh');


GO
INSERT INTO [NHANVIEN] (MANV, HOVATENNV, DIACHI, SDT, NGAYSINH, LUONG, CA,PHAI,MACV) 
VALUES ('NV001', N'Mai Thiện Căn', N'123 Đường ABC, TP.HCM', '0123456789', '1985-05-15', 1000000, N'Sáng',1,'QL');
INSERT INTO [NHANVIEN] (MANV, HOVATENNV, DIACHI, SDT, NGAYSINH, LUONG, CA,PHAI,MACV) 
VALUES ('NV002', N'Trần Thị Linh Đan', N'456 Đường XYZ, Hà Nội', '0987654321', '1990-07-20', 1200000, N'Chiều',0,'PQL');
INSERT INTO [NHANVIEN] (MANV, HOVATENNV, DIACHI, SDT, NGAYSINH, LUONG, CA,PHAI,MACV) 
VALUES ('NV003', N'Nguyễn Văn Tứ Ca', N'789 Đường LMN, Đà Nẵng', '0912345678', '1995-02-25', 1100000, N'Tối',1,'BVE');
INSERT INTO [NHANVIEN] (MANV, HOVATENNV, DIACHI, SDT, NGAYSINH, LUONG, CA,PHAI,MACV) 
VALUES ('NV004', N'Lê Thị D', N'101 Đường PQR, Cần Thơ', '0934567890', '1988-11-10', 1050000, N'Sáng',0,'KTV');
INSERT INTO [NHANVIEN] (MANV, HOVATENNV, DIACHI, SDT, NGAYSINH, LUONG, CA,PHAI,MACV) 
VALUES ('NV005', N'Ngô Minh E', N'202 Đường STU, Bình Dương', '0909876543', '1992-09-30', 1250000, N'Chiều',1,'KD');
INSERT INTO [NHANVIEN] (MANV, HOVATENNV, DIACHI, SDT, NGAYSINH, LUONG, CA,PHAI,MACV) 
VALUES ('NV006', N'Hoàng Thị F', N'303 Đường VWX, Vũng Tàu', '0981234567', '1993-12-18', 1300000, N'Tối',0,'HTR');
INSERT INTO [NHANVIEN] (MANV, HOVATENNV, DIACHI, SDT, NGAYSINH, LUONG, CA,PHAI,MACV) 
VALUES ('NV007', N'Bùi Quốc G', N'404 Đường YZ, TP.HCM', '0923456789', '1987-01-05', 1150000, N'Sáng',1,'NS');
INSERT INTO [NHANVIEN] (MANV, HOVATENNV, DIACHI, SDT, NGAYSINH, LUONG, CA,PHAI,MACV) 
VALUES ('NV008', N'Vũ Minh H', N'505 Đường ABC, Hà Nội', '0945678901', '1991-03-12', 1350000, N'Chiều',1,'BV');
INSERT INTO [NHANVIEN] (MANV, HOVATENNV, DIACHI, SDT, NGAYSINH, LUONG, CA,PHAI,MACV) 
VALUES ('NV009', N'Đặng Quốc I', N'606 Đường DEF, Đà Nẵng', '0967890123', '1994-06-22', 1200000, N'Tối',1,'VS');
INSERT INTO [NHANVIEN] (MANV, HOVATENNV, DIACHI, SDT, NGAYSINH, LUONG, CA,PHAI,MACV) 
VALUES ('NV010', N'Phan Thanh J', N'707 Đường GHI, Cần Thơ', '0981234567', '1996-08-14', 1400000, N'Sáng',1,'SVE');
GO

INSERT INTO KHACHHANG VALUES('KH1', N'Nguyễn Văn A', '0901234567', N'Hà Nội', '1985-02-15');
INSERT INTO KHACHHANG VALUES('KH2', N'Trần Thị B', '0912345678', N'TP. Hồ Chí Minh', '1990-06-20');
INSERT INTO KHACHHANG VALUES('KH3', N'Lê Văn C', '0923456789', N'Đà Nẵng', '1988-03-12');
INSERT INTO KHACHHANG VALUES('KH4', N'Phạm Thị D', '0934567890', N'Cần Thơ', '1995-11-05');
INSERT INTO KHACHHANG VALUES('KH5', N'Hoàng Văn E', '0945678901', N'Hải Phòng', '1993-09-09');
INSERT INTO KHACHHANG VALUES('KH6', N'Ngô Thị F', '0956789012', N'Bình Dương', '1987-07-01');
INSERT INTO KHACHHANG VALUES('KH7', N'Vũ Văn G', '0967890123', N'Thanh Hóa', '1992-12-25');
INSERT INTO KHACHHANG VALUES('KH8', N'Đinh Thị H', '0978901234', N'Quảng Ninh', '1990-10-10');
INSERT INTO KHACHHANG VALUES('KH9', N'Nguyễn Văn I', '0989012345', N'Nha Trang', '1985-05-30');
INSERT INTO KHACHHANG VALUES('KH10', N'Trần Thị K', '0990123456', N'Huế', '1998-01-15');


GO
INSERT INTO [LOAIVE] (MALV, TENLV, DONGIA) VALUES ('LV001', N'Vé Thường', 50000);
INSERT INTO [LOAIVE] (MALV, TENLV, DONGIA) VALUES ('LV002', N'Vé VIP', 150000);
INSERT INTO [LOAIVE] (MALV, TENLV, DONGIA) VALUES ('LV003', N'Vé Sinh Viên', 30000);
INSERT INTO [LOAIVE] (MALV, TENLV, DONGIA) VALUES ('LV004', N'Vé Trẻ Em', 20000);
INSERT INTO [LOAIVE] (MALV, TENLV, DONGIA) VALUES ('LV005', N'Vé Người Cao Tuổi', 40000);
INSERT INTO [LOAIVE] (MALV, TENLV, DONGIA) VALUES ('LV006', N'Vé Gia Đình', 120000);
INSERT INTO [LOAIVE] (MALV, TENLV, DONGIA) VALUES ('LV007', N'Vé Tháng', 250000);
INSERT INTO [LOAIVE] (MALV, TENLV, DONGIA) VALUES ('LV008', N'Vé Du Lịch', 80000);
INSERT INTO [LOAIVE] (MALV, TENLV, DONGIA) VALUES ('LV009', N'Vé Học Sinh', 25000);
INSERT INTO [LOAIVE] (MALV, TENLV, DONGIA) VALUES ('LV010', N'Vé Nhóm', 200000);




GO
INSERT INTO [DINHDANGPHIM] (MADP, DANGPHIM) VALUES ('DP001', '3D');
INSERT INTO [DINHDANGPHIM] (MADP, DANGPHIM) VALUES ('DP002', '4D');
INSERT INTO [DINHDANGPHIM] (MADP, DANGPHIM) VALUES ('DP003', 'IMAX');
INSERT INTO [DINHDANGPHIM] (MADP, DANGPHIM) VALUES ('DP004', '2D');
INSERT INTO [DINHDANGPHIM] (MADP, DANGPHIM) VALUES ('DP005', 'A');
INSERT INTO [DINHDANGPHIM] (MADP, DANGPHIM) VALUES ('DP006', 'B');
INSERT INTO [DINHDANGPHIM] (MADP, DANGPHIM) VALUES ('DP007', 'C');
INSERT INTO [DINHDANGPHIM] (MADP, DANGPHIM) VALUES ('DP008', 'D');
INSERT INTO [DINHDANGPHIM] (MADP, DANGPHIM) VALUES ('DP009', 'E');
INSERT INTO [DINHDANGPHIM] (MADP, DANGPHIM) VALUES ('DP010', 'F');

GO
INSERT INTO [THELOAIPHIM] (MALP, LOAIPHIM) VALUES ('LP001', N'Phim Hành Động');
INSERT INTO [THELOAIPHIM] (MALP, LOAIPHIM) VALUES ('LP002', N'Phim Hài');
INSERT INTO [THELOAIPHIM] (MALP, LOAIPHIM) VALUES ('LP003', N'Phim Kinh Dị');
INSERT INTO [THELOAIPHIM] (MALP, LOAIPHIM) VALUES ('LP004', N'Phim Tình Cảm');
INSERT INTO [THELOAIPHIM] (MALP, LOAIPHIM) VALUES ('LP005', N'Phim Khoa Học Viễn Tưởng');
INSERT INTO [THELOAIPHIM] (MALP, LOAIPHIM) VALUES ('LP006', N'Phim Cổ Trang');
INSERT INTO [THELOAIPHIM] (MALP, LOAIPHIM) VALUES ('LP007', N'Phim Phiêu Lưu');
INSERT INTO [THELOAIPHIM] (MALP, LOAIPHIM) VALUES ('LP008', N'Phim Thần Thoại');
INSERT INTO [THELOAIPHIM] (MALP, LOAIPHIM) VALUES ('LP009', N'Phim Chiến Tranh');
INSERT INTO [THELOAIPHIM] (MALP, LOAIPHIM) VALUES ('LP010', N'Phim Tâm Lý');

GO
INSERT INTO [Phim] (MAPHIM, MALP, MADP, TENPHIM, NHASX) 
VALUES ('PH001', 'LP001', 'DP001', N'Cuộc Chiến Sinh Tồn', 'Studio A');
INSERT INTO [Phim] (MAPHIM, MALP, MADP, TENPHIM, NHASX) 
VALUES ('PH002', 'LP002', 'DP002', N'Hài Kịch Xuyên Thế Kỷ', 'Studio B');
INSERT INTO [Phim] (MAPHIM, MALP, MADP, TENPHIM, NHASX) 
VALUES ('PH003', 'LP003', 'DP003', N'Đêm Kinh Hoàng', 'Studio C');
INSERT INTO [Phim] (MAPHIM, MALP, MADP, TENPHIM, NHASX) 
VALUES ('PH004', 'LP004', 'DP004', N'Yêu Thương Ngọt Ngào', 'Studio D');
INSERT INTO [Phim] (MAPHIM, MALP, MADP, TENPHIM, NHASX) 
VALUES ('PH005', 'LP005', 'DP005', N'Tương Lai Tươi Sáng', 'Studio E');
INSERT INTO [Phim] (MAPHIM, MALP, MADP, TENPHIM, NHASX) 
VALUES ('PH006', 'LP006', 'DP006', N'Cuộc Chiến Cổ Đại', 'Studio F');
INSERT INTO [Phim] (MAPHIM, MALP, MADP, TENPHIM, NHASX) 
VALUES ('PH007', 'LP007', 'DP007', N'Phiêu Lưu Mạo Hiểm', 'Studio G');
INSERT INTO [Phim] (MAPHIM, MALP, MADP, TENPHIM, NHASX) 
VALUES ('PH008', 'LP008', 'DP008', N'Hành Trình Thần Thoại', 'Studio H');
INSERT INTO [Phim] (MAPHIM, MALP, MADP, TENPHIM, NHASX) 
VALUES ('PH009', 'LP009', 'DP009', N'Chiến Tranh Thế Kỷ', 'Studio I');
INSERT INTO [Phim] (MAPHIM, MALP, MADP, TENPHIM, NHASX) 
VALUES ('PH010', 'LP010', 'DP010', N'Bí Mật Tâm Lý', 'Studio J');

GO                   
INSERT INTO [PHONGCHIEU] (MAPHONG, TENPHONG) VALUES ('P001', N'Phòng Chiếu 1');
INSERT INTO [PHONGCHIEU] (MAPHONG, TENPHONG) VALUES ('P002', N'Phòng Chiếu 2');
INSERT INTO [PHONGCHIEU] (MAPHONG, TENPHONG) VALUES ('P003', N'Phòng Chiếu 3');
INSERT INTO [PHONGCHIEU] (MAPHONG, TENPHONG) VALUES ('P004', N'Phòng Chiếu 4');
INSERT INTO [PHONGCHIEU] (MAPHONG, TENPHONG) VALUES ('P005', N'Phòng Chiếu 5');
INSERT INTO [PHONGCHIEU] (MAPHONG, TENPHONG) VALUES ('P006', N'Phòng Chiếu 6');
INSERT INTO [PHONGCHIEU] (MAPHONG, TENPHONG) VALUES ('P007', N'Phòng Chiếu 7');
INSERT INTO [PHONGCHIEU] (MAPHONG, TENPHONG) VALUES ('P008', N'Phòng Chiếu 8');
INSERT INTO [PHONGCHIEU] (MAPHONG, TENPHONG) VALUES ('P009', N'Phòng Chiếu 9');
INSERT INTO [PHONGCHIEU] (MAPHONG, TENPHONG) VALUES ('P010', N'Phòng Chiếu 10');





GO

INSERT INTO [SUATCHIEU] (MASUAT, MAPHONG, MAPHIM, KHOICHIEU) 
VALUES ('S001', 'P001', 'PH001', '2026-11-25 14:00:00');
INSERT INTO [SUATCHIEU] (MASUAT, MAPHONG, MAPHIM, KHOICHIEU) 
VALUES ('S002', 'P002', 'PH002', '2026-11-25 16:00:00');
INSERT INTO [SUATCHIEU] (MASUAT, MAPHONG, MAPHIM, KHOICHIEU) 
VALUES ('S003', 'P003', 'PH003', '2026-11-25 18:00:00');
INSERT INTO [SUATCHIEU] (MASUAT, MAPHONG, MAPHIM, KHOICHIEU) 
VALUES ('S004', 'P004', 'PH004', '2026-11-25 20:00:00');
INSERT INTO [SUATCHIEU] (MASUAT, MAPHONG, MAPHIM, KHOICHIEU) 
VALUES ('S005', 'P005', 'PH005', '2025-11-26 14:00:00');
INSERT INTO [SUATCHIEU] (MASUAT, MAPHONG, MAPHIM, KHOICHIEU) 
VALUES ('S006', 'P006', 'PH006', '2025-11-26 16:00:00');
INSERT INTO [SUATCHIEU] (MASUAT, MAPHONG, MAPHIM, KHOICHIEU) 
VALUES ('S007', 'P007', 'PH007', '2025-11-26 18:00:00');
INSERT INTO [SUATCHIEU] (MASUAT, MAPHONG, MAPHIM, KHOICHIEU) 
VALUES ('S008', 'P008', 'PH008', '2025-11-26 20:00:00');
INSERT INTO [SUATCHIEU] (MASUAT, MAPHONG, MAPHIM, KHOICHIEU) 
VALUES ('S009', 'P009', 'PH009', '2025-11-27 14:00:00');
INSERT INTO [SUATCHIEU] (MASUAT, MAPHONG, MAPHIM, KHOICHIEU) 
VALUES ('S010', 'P010', 'PH010', '2025-11-27 16:00:00');

GO

INSERT INTO [VE] (MAVE, MALV, MANV, MAKH, GHE, NGAYBANVE, MASUAT, TRANGTHAI) 
VALUES ('V1', 'LV001', 'NV001', 'KH1', '1', '2024-11-25 13:00:00','S001', 1);
INSERT INTO [VE] (MAVE, MALV, MANV, MAKH, GHE, NGAYBANVE, MASUAT, TRANGTHAI) 
VALUES ('V2', 'LV002', 'NV002', 'KH2', '2', '2024-11-25 14:30:00','S002', 1);
INSERT INTO [VE] (MAVE, MALV, MANV, MAKH, GHE, NGAYBANVE, MASUAT, TRANGTHAI) 
VALUES ('V3', 'LV003', 'NV003', 'KH3', '3', '2024-11-25 16:00:00','S003', 1);
INSERT INTO [VE] (MAVE, MALV, MANV, MAKH, GHE, NGAYBANVE, MASUAT, TRANGTHAI) 
VALUES ('V4', 'LV004', 'NV004', 'KH4', '4', '2024-11-25 17:30:00','S004', 1);
INSERT INTO [VE] (MAVE, MALV, MANV, MAKH, GHE, NGAYBANVE, MASUAT, TRANGTHAI) 
VALUES ('V5', 'LV005', 'NV005', 'KH5', '5', '2024-11-25 19:00:00','S005', 1);
INSERT INTO [VE] (MAVE, MALV, MANV, MAKH, GHE, NGAYBANVE, MASUAT, TRANGTHAI) 
VALUES ('V6', 'LV006', 'NV006', 'KH6', '6', '2024-11-25 20:30:00','S006', 1);
INSERT INTO [VE] (MAVE, MALV, MANV, MAKH, GHE, NGAYBANVE, MASUAT, TRANGTHAI) 
VALUES ('V7', 'LV007', 'NV007', 'KH7', '7', '2024-11-26 13:00:00','S007', 1);
INSERT INTO [VE] (MAVE, MALV, MANV, MAKH, GHE, NGAYBANVE, MASUAT, TRANGTHAI) 
VALUES ('V8', 'LV008', 'NV008', 'KH8', '8', '2024-11-26 14:30:00','S008', 1);
INSERT INTO [VE] (MAVE, MALV, MANV, MAKH, GHE, NGAYBANVE, MASUAT, TRANGTHAI) 
VALUES ('V9', 'LV009', 'NV009', 'KH9', '9', '2024-11-26 16:00:00','S009', 1);
INSERT INTO [VE] (MAVE, MALV, MANV, MAKH, GHE, NGAYBANVE, MASUAT, TRANGTHAI) 
VALUES ('V10', 'LV010', 'NV010', 'KH10', '10', '2024-11-26 17:30:00','S010', 1);

GO
INSERT INTO TAIKHOAN (MANV,TENTAIKHOAN, MATKHAU, QUYENHAN) VALUES ('NV001','admin','1',N'Admin');
INSERT INTO TAIKHOAN (MANV,TENTAIKHOAN, MATKHAU, QUYENHAN) VALUES ('NV002','kt','1',N'Kế toán');
INSERT INTO TAIKHOAN (MANV,TENTAIKHOAN, MATKHAU, QUYENHAN) VALUES ('NV003','nv','1',N'Nhân viên');
GO



GO
--Rang buoc ngay ban khong duoc lon hon ngay chieu
CREATE TRIGGER TRG_CheckNgayBan
ON VE
AFTER INSERT, UPDATE
AS
BEGIN
    IF EXISTS (
        SELECT 1 
        FROM VE v
        JOIN SUATCHIEU s ON v.MASUAT = s.MASUAT
        WHERE v.NGAYBANVE > s.KHOICHIEU
    )
    BEGIN
        RAISERROR ('Ngày bán không được lớn hơn thời gian khởi chiếu.', 16, 1);
        ROLLBACK TRANSACTION;
    END
END;

GO 
--Rang buoc ghe cung phong khong duoc trung
CREATE TRIGGER TRG_CheckUniqueGhe
ON VE
INSTEAD OF INSERT
AS
BEGIN
    IF EXISTS (
        SELECT 1
        FROM VE v
        JOIN INSERTED i
        ON v.MASUAT = i.MASUAT AND v.GHE = i.GHE
    )
    BEGIN
        RAISERROR ('Ghế đã được đặt', 16, 1);
    END
    ELSE
    BEGIN
        INSERT INTO VE (MAVE, MALV, MANV, MAKH, GHE, NGAYBANVE, MASUAT, TRANGTHAI)
        SELECT MAVE, MALV, MANV, MAKH, GHE, NGAYBANVE, MASUAT, TRANGTHAI
        FROM INSERTED;
    END
END;

GO

SELECT * FROM DINHDANGPHIM
SELECT * FROM KHACHHANG
SELECT * FROM LOAIVE
SELECT * FROM NHANVIEN
SELECT * FROM PHONGCHIEU
SELECT * FROM VE
SELECT * FROM SUATCHIEU
SELECT * FROM PHIM
SELECT * FROM THELOAIPHIM
SELECT * FROM TAIKHOAN
SELECT * FROM CHUCVU

